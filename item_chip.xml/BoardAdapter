package com.example.myapplication;

import android.content.Context;
import android.content.Intent;
import android.net.Uri;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import com.bumptech.glide.Glide;
import com.example.myapplication.databinding.ItemBoardPostBinding;

import java.util.ArrayList;

public class BoardAdapter extends RecyclerView.Adapter<BoardAdapter.BoardViewHolder> {

    private ArrayList<BoardPost> postList;
    private Context context; // 클릭 리스너에서 Activity를 시작하기 위해 Context 추가

    public BoardAdapter(Context context, ArrayList<BoardPost> postList) {
        this.context = context;
        this.postList = postList;
    }

    @NonNull
    @Override
    public BoardViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
        ItemBoardPostBinding binding = ItemBoardPostBinding.inflate(
                LayoutInflater.from(parent.getContext()), parent, false
        );
        return new BoardViewHolder(binding);
    }

    @Override
    public void onBindViewHolder(@NonNull BoardViewHolder holder, int position) {
        BoardPost post = postList.get(position);
        holder.bind(post);

        // ✅ 클릭 시 상세보기 페이지로 이동
        holder.itemView.setOnClickListener(v -> {
            Intent intent = new Intent(context, BoardDetailActivity.class);
            intent.putExtra("post_data", post); // Serializable로 전달
            context.startActivity(intent);
        });
    }

    @Override
    public int getItemCount() {
        return postList.size();
    }

    // ✅ 외부에서 리스트 갱신용 (BoardFragment에서 사용)
    public void setPostList(ArrayList<BoardPost> newList) {
        this.postList = newList;
        notifyDataSetChanged();
    }

    static class BoardViewHolder extends RecyclerView.ViewHolder {
        private final ItemBoardPostBinding binding;

        public BoardViewHolder(ItemBoardPostBinding binding) {
            super(binding.getRoot());
            this.binding = binding;
        }

        public void bind(BoardPost post) {
            binding.textPostTitle.setText(post.getTitle());
            binding.textPostDate.setText(post.getDate());

            // ✅ 내용이 너무 길면 일부만 표시
            String content = post.getContent();
            if (content != null && content.length() > 100) {
                content = content.substring(0, 100) + "...";
            }
            binding.textPostSnippet.setText(content);

            // ✅ 썸네일 이미지 (첫 번째 이미지 기준)
            String thumbnailUri = post.getThumbnailUri();
            if (thumbnailUri != null && !thumbnailUri.isEmpty()) {
                binding.imagePostThumbnail.setVisibility(View.VISIBLE);
                Glide.with(itemView.getContext())
                        .load(Uri.parse(thumbnailUri))
                        .centerCrop()
                        .into(binding.imagePostThumbnail);
            } else {
                binding.imagePostThumbnail.setVisibility(View.GONE);
            }
        }
    }
}

